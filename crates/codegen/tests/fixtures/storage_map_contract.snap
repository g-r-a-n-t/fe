---
source: crates/codegen/tests/yul.rs
expression: output
input_file: tests/fixtures/storage_map_contract.fe
---
object "BalanceMap" {
  code {
    function init() {
      let v0 := datasize("BalanceMap_deployed")
      let v1 := dataoffset("BalanceMap_deployed")
      codecopy(0, v1, v0)
      return(0, v0)
    }
    init()
  }

  object "BalanceMap_deployed" {
    code {
      function abi_encode(value, ops) {
        let v0 := 0
        mstore(v0, value)
        return(v0, 32)
      }
      function get_allowance__eff_mem(addr, allowances) -> ret {
        let v0 := storagemap_k__v__const_salt__u256__get__u256_u256_1__3c02c0f2b86be0bb(allowances, addr)
        ret := v0
        leave
      }
      function get_balance__eff_mem(addr, balances) -> ret {
        let v0 := storagemap_k__v__const_salt__u256__get__u256_u256_0__6a346ad3c930d971(balances, addr)
        ret := v0
        leave
      }
      function runtime() {
        storagemap_k__v__const_salt__u256__new__u256_u256_0__6a346ad3c930d971()
        storagemap_k__v__const_salt__u256__new__u256_u256_1__3c02c0f2b86be0bb()
        let v0 := calldataload(0)
        let v1 := shr(224, v0)
        switch v1
          case 2630350600 {
            let v2 := calldataload(4)
            let v3 := get_balance__eff_mem(v2, 0)
            let v4 := v3
            abi_encode(v4, 0)
          }
          case 1246470123 {
            let v5 := calldataload(4)
            let v6 := calldataload(36)
            set_balance__eff_mem(v5, v6, 0)
            abi_encode(0, 0)
          }
          case 2430412327 {
            let v7 := calldataload(4)
            let v8 := calldataload(36)
            let v9 := calldataload(68)
            let v10 := transfer__eff_mem(v7, v8, v9, 0)
            let v11 := v10
            abi_encode(v11, 0)
          }
          case 3378517838 {
            let v12 := calldataload(4)
            let v13 := get_allowance__eff_mem(v12, 0)
            let v14 := v13
            abi_encode(v14, 0)
          }
          case 197806145 {
            let v15 := calldataload(4)
            let v16 := calldataload(36)
            set_allowance__eff_mem(v15, v16, 0)
            abi_encode(0, 0)
          }
          default {
            return(0, 0)
          }
      }
      function set_allowance__eff_mem(addr, value, allowances) {
        storagemap_k__v__const_salt__u256__set__u256_u256_1__3c02c0f2b86be0bb(allowances, addr, value)
        leave
      }
      function set_balance__eff_mem(addr, value, balances) {
        storagemap_k__v__const_salt__u256__set__u256_u256_0__6a346ad3c930d971(balances, addr, value)
        leave
      }
      function storagemap_get_word_with_salt__u256__3271ca15373d4483(key, salt) -> ret {
        let v0 := storagemap_storage_slot_with_salt__u256__3271ca15373d4483(key, salt)
        let v1 := sload(v0)
        ret := v1
        leave
      }
      function storagemap_k__v__const_salt__u256__get__u256_u256_0__6a346ad3c930d971(self, key) -> ret {
        let v0 := storagemap_get_word_with_salt__u256__3271ca15373d4483(key, 0)
        let v1 := u256_wordrepr_from_word(v0)
        ret := v1
        leave
      }
      function storagemap_k__v__const_salt__u256__get__u256_u256_1__3c02c0f2b86be0bb(self, key) -> ret {
        let v0 := storagemap_get_word_with_salt__u256__3271ca15373d4483(key, 1)
        let v1 := u256_wordrepr_from_word(v0)
        ret := v1
        leave
      }
      function storagemap_k__v__const_salt__u256__new__u256_u256_0__6a346ad3c930d971() {
        leave
      }
      function storagemap_k__v__const_salt__u256__new__u256_u256_1__3c02c0f2b86be0bb() {
        leave
      }
      function storagemap_k__v__const_salt__u256__set__u256_u256_0__6a346ad3c930d971(self, key, value) {
        let v0 := u256_wordrepr_to_word(value)
        storagemap_set_word_with_salt__u256__3271ca15373d4483(key, 0, v0)
        leave
      }
      function storagemap_k__v__const_salt__u256__set__u256_u256_1__3c02c0f2b86be0bb(self, key, value) {
        let v0 := u256_wordrepr_to_word(value)
        storagemap_set_word_with_salt__u256__3271ca15373d4483(key, 1, v0)
        leave
      }
      function storagemap_set_word_with_salt__u256__3271ca15373d4483(key, salt, word) {
        let v0 := storagemap_storage_slot_with_salt__u256__3271ca15373d4483(key, salt)
        sstore(v0, word)
        leave
      }
      function storagemap_storage_slot_with_salt__u256__3271ca15373d4483(key, salt) -> ret {
        let v0 := mload(64)
        let v1 := u256_storagekey_write_key(v0, key)
        mstore(add(v0, v1), salt)
        let v2 := keccak256(v0, add(v1, 32))
        ret := v2
        leave
      }
      function transfer__eff_mem(from, to, amount, balances) -> ret {
        let v0 := storagemap_k__v__const_salt__u256__get__u256_u256_0__6a346ad3c930d971(balances, from)
        let v1 := lt(v0, amount)
        if v1 {
          ret := 1
          leave
        }
        if iszero(v1) {
          let v2 := storagemap_k__v__const_salt__u256__get__u256_u256_0__6a346ad3c930d971(balances, to)
          storagemap_k__v__const_salt__u256__set__u256_u256_0__6a346ad3c930d971(balances, from, sub(v0, amount))
          storagemap_k__v__const_salt__u256__set__u256_u256_0__6a346ad3c930d971(balances, to, add(v2, amount))
          ret := 0
          leave
        }
      }
      function u256_storagekey_write_key(ptr, self) -> ret {
        mstore(ptr, self)
        ret := 32
        leave
      }
      function u256_wordrepr_from_word(word) -> ret {
        ret := word
        leave
      }
      function u256_wordrepr_to_word(self) -> ret {
        ret := self
        leave
      }
      runtime()
      return(0, 0)
    }
  }
}
