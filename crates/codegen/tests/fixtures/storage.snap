---
source: crates/codegen/tests/yul.rs
expression: output
input_file: tests/fixtures/storage.fe
---
object "Coin" {
  code {
    function init() {
      let v0 := 0
      let v1 := datasize("Coin_deployed")
      let v2 := dataoffset("Coin_deployed")
      codecopy(0, v2, v1)
      return(0, v1)
    }
    init()
  }

  object "Coin_deployed" {
    code {
      function abi_encode(value, ops) {
        let v0 := 0
        mstore(v0, value)
        return(v0, 32)
      }
      function balance_of_raw(user, store) -> ret {
        let v0 := 0
        switch user
          case 0 {
            let v1 := sload(store)
            v0 := v1
          }
          default {
            let v2 := sload(add(store, 1))
            v0 := v2
          }
        ret := v0
        leave
      }
      function credit_alice(amount, store, supply) -> ret {
        let v0 := sload(store)
        sstore(store, add(v0, amount))
        let v1 := sload(supply)
        sstore(supply, add(v1, amount))
        let v2 := sload(store)
        ret := v2
        leave
      }
      function credit_bob(amount, store, supply) -> ret {
        let v0 := sload(add(store, 1))
        sstore(add(store, 1), add(v0, amount))
        let v1 := sload(supply)
        sstore(supply, add(v1, amount))
        let v2 := sload(add(store, 1))
        ret := v2
        leave
      }
      function runtime() {
        let v0 := 0
        let v1 := stor_ptr__Evm_CoinStore__d1ec7298de486d2f(v0, 0)
        let v2 := stor_ptr__Evm_TotalSupply__b0f1a753085dcbd(v0, 2)
        let v3 := v1
        let v4 := v2
        let v5 := calldataload(0)
        let v6 := shr(224, v5)
        switch v6
          case 2877082652 {
            let v7 := calldataload(4)
            let v8 := calldataload(36)
            let v9 := 0
            switch v7
              case 0 {
                let v10 := credit_alice(v8, v3, v4)
                v9 := v10
              }
              default {
                let v11 := credit_bob(v8, v3, v4)
                v9 := v11
              }
            let v12 := v9
            abi_encode(v12, 0)
          }
          case 1818602213 {
            let v13 := calldataload(4)
            let v14 := balance_of_raw(v13, v3)
            abi_encode(v14, 0)
          }
          case 217554442 {
            let v15 := calldataload(4)
            let v16 := calldataload(36)
            let v17 := 0
            switch v15
              case 0 {
                let v18 := transfer_from_alice(v16, v3)
                v17 := v18
              }
              default {
                let v19 := transfer_from_bob(v16, v3)
                v17 := v19
              }
            let v20 := v17
            let v21 := transfer_result_code(v20)
            abi_encode(v21, 0)
          }
          case 960555502 {
            let v22 := total_supply(v4)
            abi_encode(v22, 0)
          }
          default {
            return(0, 0)
          }
      }
      function stor_ptr__Evm_CoinStore__d1ec7298de486d2f(self, slot) -> ret {
        let v0 := slot
        ret := v0
        leave
      }
      function stor_ptr__Evm_TotalSupply__b0f1a753085dcbd(self, slot) -> ret {
        let v0 := slot
        ret := v0
        leave
      }
      function total_supply(supply) -> ret {
        let v0 := sload(supply)
        ret := v0
        leave
      }
      function transfer_from_alice(amount, store) -> ret {
        let v0 := sload(store)
        let v1 := lt(v0, amount)
        if v1 {
          let v2 := mload(0x40)
          if iszero(v2) {
            v2 := 0x80
          }
          mstore(0x40, add(v2, 32))
          mstore(v2, 1)
          ret := v2
          leave
        }
        if iszero(v1) {
          let v3 := sload(store)
          sstore(store, sub(v3, amount))
          let v4 := sload(add(store, 1))
          sstore(add(store, 1), add(v4, amount))
          let v5 := mload(0x40)
          if iszero(v5) {
            v5 := 0x80
          }
          mstore(0x40, add(v5, 32))
          mstore(v5, 0)
          ret := v5
          leave
        }
      }
      function transfer_from_bob(amount, store) -> ret {
        let v0 := sload(add(store, 1))
        let v1 := lt(v0, amount)
        if v1 {
          let v2 := mload(0x40)
          if iszero(v2) {
            v2 := 0x80
          }
          mstore(0x40, add(v2, 32))
          mstore(v2, 1)
          ret := v2
          leave
        }
        if iszero(v1) {
          let v3 := sload(add(store, 1))
          sstore(add(store, 1), sub(v3, amount))
          let v4 := sload(store)
          sstore(store, add(v4, amount))
          let v5 := mload(0x40)
          if iszero(v5) {
            v5 := 0x80
          }
          mstore(0x40, add(v5, 32))
          mstore(v5, 0)
          ret := v5
          leave
        }
      }
      function transfer_result_code(res) -> ret {
        let v0 := 0
        let v1 := mload(res)
        switch v1
          case 0 {
            v0 := 0
          }
          case 1 {
            v0 := 1
          }
          default {
          }
        ret := v0
        leave
      }
      runtime()
      return(0, 0)
    }
  }
}
